<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:MiniTCPTunnel.Client"
        xmlns:conv="clr-namespace:MiniTCPTunnel.Client"
        x:Class="MiniTCPTunnel.Client.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Width="920"
        Height="560"
        MinWidth="720"
        MinHeight="420"
        Title="MiniTCPTunnel Client">
  <!--
    리소스 섹션: 연결 상태에 따라 색을 바꾸는 변환기를 등록한다.
    상단 알림 패널의 상태 원형 표시에서 사용한다.
  -->
  <Window.Resources>
    <conv:BoolToBrushConverter x:Key="BoolToBrushConverter"
                               TrueBrush="#22C55E"
                               FalseBrush="#F59E0B" />
  </Window.Resources>
  <!--
    메인 화면: 터널 목록 + 상태 표시 + 빠른 제어 버튼.
    추후 다이얼로그(추가/수정/삭제)와 트레이 기능을 연결할 수 있게 레이아웃을 단순하게 유지한다.
  -->
  <DockPanel Margin="16">
    <!--
      맨 위 독립 알림 패널:
      - 서버 연결 상태를 짧은 문구 + 작은 원형으로 표시한다.
      - 나중에 토스트/에러 배너로 확장할 수 있도록 분리한다.
    -->
    <Border DockPanel.Dock="Top"
            Padding="10"
            CornerRadius="8"
            Background="#F8FAFC"
            BorderBrush="#E2E8F0"
            BorderThickness="1"
            Margin="0,0,0,12">
      <Grid ColumnDefinitions="*,Auto">
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
          <!-- 연결 상태 텍스트 -->
          <TextBlock Text="{Binding ConnectionBadgeText}"
                     FontSize="12"
                     FontWeight="SemiBold"
                     Foreground="#334155"/>
          <!-- 작은 동그란 상태 표시 (연결됨/연결 중) -->
          <Ellipse Width="10"
                   Height="10"
                   Margin="8,0,0,0"
                   Fill="{Binding IsConnected, Converter={StaticResource BoolToBrushConverter}}"
                   Stroke="#0F172A"
                   StrokeThickness="1" />
        </StackPanel>

        <!-- 같은 줄에 배치되는 접속/해제/설정 버튼 -->
        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
          <Button Content="접속"
                  Command="{Binding ConnectCommand}" />
          <Button Content="해제"
                  Margin="8,0,0,0"
                  Command="{Binding DisconnectCommand}" />
          <Button Content="설정"
                  Margin="8,0,0,0"
                  Command="{Binding OpenSettingsCommand}" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- 상단 상태 영역 -->
    <Border DockPanel.Dock="Top"
            Padding="12"
            CornerRadius="8"
            Background="#2E3440">
      <Grid ColumnDefinitions="*,Auto">
        <StackPanel>
          <TextBlock Text="MiniTCP Tunnel Client"
                     FontSize="18"
                     FontWeight="SemiBold"
                     Foreground="White"/>
          <TextBlock Text="{Binding StatusText}"
                     Margin="0,4,0,0"
                     Foreground="#C0D0FF"/>
        </StackPanel>
        <StackPanel Grid.Column="1"
                    HorizontalAlignment="Right">
          <TextBlock Text="{Binding ConnectionSummary}"
                     Foreground="White"
                     HorizontalAlignment="Right"/>
          <TextBlock Text="{Binding RunningSummary}"
                     Margin="0,4,0,0"
                     Foreground="#A7F3D0"
                     HorizontalAlignment="Right"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- 중단: 터널 목록 -->
    <StackPanel Margin="0,16,0,0" Spacing="8">
      <Grid ColumnDefinitions="*,Auto,Auto,Auto">
        <TextBlock Text="터널 목록"
                   FontSize="16"
                   FontWeight="SemiBold"/>
        <Button Grid.Column="1"
                Margin="8,0,0,0"
                Content="추가"
                Command="{Binding AddTunnelCommand}"/>
        <Button Grid.Column="2"
                Margin="8,0,0,0"
                Content="수정"
                Command="{Binding EditTunnelCommand}"/>
        <Button Grid.Column="3"
                Margin="8,0,0,0"
                Content="삭제"
                Command="{Binding RemoveTunnelCommand}"/>
      </Grid>

      <Border Padding="8"
              CornerRadius="8"
              Background="#F1F5F9">
        <ListBox ItemsSource="{Binding Tunnels}">
          <ListBox.ItemTemplate>
            <!-- 컴파일된 바인딩을 위해 항목 타입을 명시한다. -->
            <DataTemplate x:DataType="vm:TunnelRowViewModel">
              <Border Padding="8" CornerRadius="6" Background="White" Margin="0,4">
                <!-- Grid의 간격 속성은 버전에 따라 다를 수 있어 Margin으로 간격을 준다. -->
                <Grid ColumnDefinitions="*,Auto,Auto">
                  <StackPanel>
                    <TextBlock Text="{Binding Name}"
                               FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding EndpointSummary}"
                               FontSize="12"
                               Foreground="#64748B"/>
                  </StackPanel>
                  <TextBlock Grid.Column="1"
                             Text="{Binding StatusText}"
                             VerticalAlignment="Center"
                             Margin="12,0,0,0"
                             Foreground="#2563EB"/>
                  <TextBlock Grid.Column="2"
                             Text="{Binding ConnectionCountText}"
                             VerticalAlignment="Center"
                             Margin="12,0,0,0"
                             Foreground="#0F766E"/>
                </Grid>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </Border>
    </StackPanel>
  </DockPanel>
</Window>
